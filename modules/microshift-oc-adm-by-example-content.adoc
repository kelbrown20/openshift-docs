// NOTE: The contents of this file are auto-generated
// This template is for admin ('oc adm ...') commands
// Uses 'source,bash' for proper syntax highlighting for comments in examples

:_content-type: REFERENCE
[id="openshift-cli-admin_{context}"]
= OpenShift CLI (oc) administrator commands



== oc adm catalog mirror
Mirror an operator-registry catalog

.Example usage
[source,bash,options="nowrap"]
----
  # Mirror an operator-registry image and its contents to a registry
  oc adm catalog mirror quay.io/my/image:latest myregistry.com
  
  # Mirror an operator-registry image and its contents to a particular namespace in a registry
  oc adm catalog mirror quay.io/my/image:latest myregistry.com/my-namespace
  
  # Mirror to an airgapped registry by first mirroring to files
  oc adm catalog mirror quay.io/my/image:latest file:///local/index
  oc adm catalog mirror file:///local/index/my/image:latest my-airgapped-registry.com
  
  # Configure a cluster to use a mirrored registry
  oc apply -f manifests/imageDigestMirrorSet.yaml
  
  # Edit the mirroring mappings and mirror with "oc image mirror" manually
  oc adm catalog mirror --manifests-only quay.io/my/image:latest myregistry.com
  oc image mirror -f manifests/mapping.txt
  
  # Delete all ImageDigestMirrorSets generated by oc adm catalog mirror
  oc delete imagedigestmirrorset -l operators.openshift.org/catalog=true
----



== oc adm copy-to-node
Copies specified files to the node.

.Example usage
[source,bash,options="nowrap"]
----
  # copy a new bootstrap kubeconfig file to every node
  oc adm clusteroperators copy-to-node --copy=new-bootstrap-kubeconfig=/etc/kubernetes/kubeconfig
  
  # copy a new bootstrap kubeconfig file to masters
  oc adm clusteroperators copy-to-node --copy=new-bootstrap-kubeconfig=/etc/kubernetes/kubeconfig -l node-role.kubernetes.io/master
----



== oc adm inspect
Collect debugging data for a given resource

.Example usage
[source,bash,options="nowrap"]
----
  # Collect debugging data for the "openshift-apiserver" clusteroperator
  oc adm inspect clusteroperator/openshift-apiserver
  
  # Collect debugging data for the "openshift-apiserver" and "kube-apiserver" clusteroperators
  oc adm inspect clusteroperator/openshift-apiserver clusteroperator/kube-apiserver
  
  # Collect debugging data for all clusteroperators
  oc adm inspect clusteroperator
  
  # Collect debugging data for all clusteroperators and clusterversions
  oc adm inspect clusteroperators,clusterversions
----



== oc adm migrate icsp
Update imagecontentsourcepolicy file(s) to imagedigestmirrorset file(s)

.Example usage
[source,bash,options="nowrap"]
----
  # Update the imagecontentsourcepolicy.yaml file to a new imagedigestmirrorset file under the mydir directory
  oc adm migrate icsp imagecontentsourcepolicy.yaml --dest-dir mydir
----



== oc adm ocp-certificates monitor-certificates
Watch platform certificates.

.Example usage
[source,bash,options="nowrap"]
----
  # Watch platform certificates.
  oc adm ocp-certificates monitor-certificates
----



== oc adm ocp-certificates regenerate-leaf
Regenerate client and serving certificates of an OpenShift cluster

.Example usage
[source,bash,options="nowrap"]
----
  # Regenerate all known leaf certificates on the cluster.
  oc adm certificates regenerate-leaf -A --all
  
  # Regenerate a leaf certificate contained in a particular secret.
  oc adm ocp-certificates regenerate-leaf -n openshift-config-managed kube-controller-manager-client-cert
----



== oc adm ocp-certificates regenerate-machine-config-server-serving-cert
Regenerate the machine config operator certificates in an OpenShift cluster

.Example usage
[source,bash,options="nowrap"]
----
  # Regenerate the MCO certs without modifying user-data secrets
  oc adm certificates regenerate-machine-config-server-serving-cert --update-ignition=false
  
  # Update the user-data secrets to use new MCS certs
  oc adm certificates update-ignition-ca-bundle-for-machine-config-server
----



== oc adm ocp-certificates regenerate-top-level
Regenerate the top level certificates in an OpenShift cluster

.Example usage
[source,bash,options="nowrap"]
----
  # Regenerate all known signing certificates on the cluster.
  oc adm certificates regenerate-signers -A --all
  
  # Regenerate the signing certificate contained in a particular secret.
  oc adm certificates regenerate-signers -n openshift-kube-apiserver-operator loadbalancer-serving-signer
----



== oc adm ocp-certificates remove-old-trust
Remove old CAs from ConfigMaps representing platform trust bundles in an OpenShift cluster

.Example usage
[source,bash,options="nowrap"]
----
  # Remove all known trust bundles in the cluster
  oc adm ocp-certificates remove-old-trust configmaps -A --all
  
  # Remove a trust bundled contained in a particular config map
  oc adm ocp-certificates remove-old-trust -n openshift-config-managed configmaps/kube-apiserver-aggregator-client-ca
  
  #  Remove only CA certificates created before a certain date from all trust bundles
  oc adm ocp-certificates remove-old-trust configmaps -A --all --created-before 2023-06-05T14:44:06Z
----



== oc adm ocp-certificates update-ignition-ca-bundle-for-machine-config-server
Update user-data secrets in an OpenShift cluster to use updated MCO certfs

.Example usage
[source,bash,options="nowrap"]
----
  # Regenerate the MCO certs without modifying user-data secrets
  oc adm certificates regenerate-machine-config-server-serving-cert --update-ignition=false
  
  # Update the user-data secrets to use new MCS certs
  oc adm certificates update-ignition-ca-bundle-for-machine-config-server
----



== oc adm reboot-machine-config-pool
Initiate reboot of the specified MachineConfigPool.

.Example usage
[source,bash,options="nowrap"]
----
  # Reboot all MachineConfigPools
  oc adm reboot-machine-config-pool mcp/worker mcp/master
  
  # Reboot all MachineConfigPools that inherit from worker.  This include all custom MachineConfigPools and infra.
  oc adm reboot-machine-config-pool mcp/worker
  
  # Reboot masters
  oc adm reboot-machine-config-pool mcp/master
----



== oc adm release extract
Extract the contents of an update payload to disk

.Example usage
[source,bash,options="nowrap"]
----
  # Use git to check out the source code for the current cluster release to DIR
  oc adm release extract --git=DIR
  
  # Extract cloud credential requests for AWS
  oc adm release extract --credentials-requests --cloud=aws
  
  # Use git to check out the source code for the current cluster release to DIR from linux/s390x image
  # Note: Wildcard filter is not supported; pass a single os/arch to extract
  oc adm release extract --git=DIR quay.io/openshift-release-dev/ocp-release:4.11.2 --filter-by-os=linux/s390x
----



== oc adm release info
Display information about a release

.Example usage
[source,bash,options="nowrap"]
----
  # Show information about the cluster's current release
  oc adm release info
  
  # Show the source code that comprises a release
  oc adm release info 4.11.2 --commit-urls
  
  # Show the source code difference between two releases
  oc adm release info 4.11.0 4.11.2 --commits
  
  # Show where the images referenced by the release are located
  oc adm release info quay.io/openshift-release-dev/ocp-release:4.11.2 --pullspecs
  
  # Show information about linux/s390x image
  # Note: Wildcard filter is not supported; pass a single os/arch to extract
  oc adm release info quay.io/openshift-release-dev/ocp-release:4.11.2 --filter-by-os=linux/s390x
----



== oc adm release mirror
Mirror a release to a different image registry location

.Example usage
[source,bash,options="nowrap"]
----
  # Perform a dry run showing what would be mirrored, including the mirror objects
  oc adm release mirror 4.11.0 --to myregistry.local/openshift/release \
  --release-image-signature-to-dir /tmp/releases --dry-run
  
  # Mirror a release into the current directory
  oc adm release mirror 4.11.0 --to file://openshift/release \
  --release-image-signature-to-dir /tmp/releases
  
  # Mirror a release to another directory in the default location
  oc adm release mirror 4.11.0 --to-dir /tmp/releases
  
  # Upload a release from the current directory to another server
  oc adm release mirror --from file://openshift/release --to myregistry.com/openshift/release \
  --release-image-signature-to-dir /tmp/releases
  
  # Mirror the 4.11.0 release to repository registry.example.com and apply signatures to connected cluster
  oc adm release mirror --from=quay.io/openshift-release-dev/ocp-release:4.11.0-x86_64 \
  --to=registry.example.com/your/repository --apply-release-image-signature
----



== oc adm restart-kubelet
Restarts kubelet on the specified nodes

.Example usage
[source,bash,options="nowrap"]
----
  # Restart all the nodes,  10% at a time
  oc adm clusteroperators restart-kubelet nodes --all
  
  # Restart all the nodes,  20 nodes at a time
  oc adm clusteroperators restart-kubelet nodes --all --parallelism=20
  
  # Restart all the nodes,  15% at a time
  oc adm clusteroperators restart-kubelet nodes --all --parallelism=15%
  
  # Restart all the masters at the same time
  oc adm clusteroperators restart-kubelet nodes -l node-role.kubernetes.io/master --parallelism=100%
----



== oc adm taint
Update the taints on one or more nodes

.Example usage
[source,bash,options="nowrap"]
----
  # Update node 'foo' with a taint with key 'dedicated' and value 'special-user' and effect 'NoSchedule'
  # If a taint with that key and effect already exists, its value is replaced as specified
  oc adm taint nodes foo dedicated=special-user:NoSchedule
  
  # Remove from node 'foo' the taint with key 'dedicated' and effect 'NoSchedule' if one exists
  oc adm taint nodes foo dedicated:NoSchedule-
  
  # Remove from node 'foo' all the taints with key 'dedicated'
  oc adm taint nodes foo dedicated-
  
  # Add a taint with key 'dedicated' on nodes having label mylabel=X
  oc adm taint node -l myLabel=X  dedicated=foo:PreferNoSchedule
  
  # Add to node 'foo' a taint with key 'bar' and no value
  oc adm taint nodes foo bar:NoSchedule
----



== oc adm top pod
Display resource (CPU/memory) usage of pods

.Example usage
[source,bash,options="nowrap"]
----
  # Show metrics for all pods in the default namespace
  oc adm top pod
  
  # Show metrics for all pods in the given namespace
  oc adm top pod --namespace=NAMESPACE
  
  # Show metrics for a given pod and its containers
  oc adm top pod POD_NAME --containers
  
  # Show metrics for the pods defined by label name=myLabel
  oc adm top pod -l name=myLabel
----



== oc adm wait-for-node-reboot
Wait for nodes to reboot after running `oc adm reboot-machine-config-pool`

.Example usage
[source,bash,options="nowrap"]
----
  # Wait for all nodes to complete a requested reboot from 'oc adm reboot-machine-config-pool mcp/worker mcp/master'
  oc adm wait-for-node-reboot nodes --all
  
  # Wait for masters to complete a requested reboot from 'oc adm reboot-machine-config-pool mcp/master'
  oc adm wait-for-node-reboot nodes -l node-role.kubernetes.io/master
  
  # Wait for masters to complete a specific reboot
  oc adm wait-for-node-reboot nodes -l node-role.kubernetes.io/master --reboot-number=4
----



== oc adm wait-for-stable-cluster
wait for the platform operators to become stable

.Example usage
[source,bash,options="nowrap"]
----
  # Wait for all clusteroperators to become stable
  oc adm clusteroperator wait-for-stable-cluster
  
  # Consider operators to be stable if they report as such for 5 minutes straight
  oc adm clusteroperator wait-for-stable-cluster --minimum-stable-period 5m
----


